<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>iptv hls</title>
  

</head>
<body>
<!-- partial:index.partial.html -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>IPTV Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/dashjs/dist/dash.all.min.js"></script>
<style>
html,body{margin:0;height:100%;overflow:hidden;font-family:sans-serif}
body.dark{background:#121212;color:#eee}
#video-container{width:100%;height:100%;position:relative;background:#000}
video{width:100%;height:100%;object-fit:contain;background:#000}
.menu-buttons{position:absolute;top:10px;left:10px;right:10px;display:flex;justify-content:space-between;z-index:3}
.menu-btn{background:transparent;color:rgba(255,255,255,0.3);padding:8px;border-radius:4px;cursor:pointer;display:flex;align-items:center;box-shadow:none;border:none;transition:color 0.2s ease}
.menu-btn:hover{color:rgba(255,255,255,1)}
.menu-btn i.material-icons{font-size:24px}
.sidenav{width:320px;background:#f9f9f9;color:#000;overflow-y:auto}
body.dark .sidenav{background:#1e1e1e;color:#fff}
#search-container{position:sticky;top:0;background:inherit;z-index:1;padding:10px;border-bottom:1px solid #ccc}
.channel-group{background:#d0e2f2;margin:4px;padding:8px 12px;font-weight:bold;cursor:pointer;border-left:4px solid #42a5f5;border-radius:4px;display:flex;justify-content:space-between}
body.dark .channel-group{background:#333;border-color:#90caf9;color:#90caf9}
.channel-list{display:none}
.channel-card{display:flex;align-items:center;padding:8px 12px;cursor:pointer;border-bottom:1px solid #ddd}
body.dark .channel-card{border-bottom:1px solid #444}
.channel-card:hover{background:#f0f0f0}
body.dark .channel-card:hover{background:#333}
.channel-logo{width:40px;height:40px;object-fit:contain;margin-right:12px;background:#fff;border:1px solid #ddd;border-radius:4px}
.channel-info{flex-grow:1}
.channel-title{font-size:.95em;margin:0;font-weight:700;color:#333}
body.dark .channel-title{color:#fff}
.channel-epg{font-size:.8em;color:#fbc02d;margin:0;font-weight:300}
.channel-card.current-channel{background:#c8e6c9 !important}
body.dark .channel-card.current-channel{background:#2e7d32 !important;color:#fff}
.channel-card .current-icon{margin-left:auto;color:green;font-size:1.2em}
#search-results{max-height:300px;overflow-y:auto;background:#fff;border:1px solid #ccc;margin:0 10px 10px;display:none;z-index:10;position:relative}
body.dark #search-results{background:#222;color:#fff;border-color:#444}
#search-results .channel-card{border-bottom:1px solid #eee}
.input-row{display:flex;gap:8px;align-items:stretch;margin-bottom:10px}
.input-row input{flex:1}
.switch-label{display:flex;align-items:center;gap:8px;margin:10px 0}
</style>
</head>
<body>

<div id="video-container">
  <div class="menu-buttons">
    <button id="toggle-left" class="menu-btn"><i class="material-icons">live_tv</i></button>
    <button id="toggle-right" class="menu-btn"><i class="material-icons">settings</i></button>
  </div>
  <video id="video" controls autoplay playsinline webkit-playsinline></video>
</div>

<ul id="menu-left" class="sidenav">
  <li id="search-container">
    <div class="input-field" style="margin:0;"><input type="text" id="search" placeholder="Kanallarƒ± ara"></div>
  </li>
  <div id="search-results"></div>
  <div id="channel-groups"></div>
</ul>

<ul id="menu-right" class="sidenav right">
  <li style="padding:10px">
 

      <input type="text" id="url-input" placeholder=" " class="browser-default">
    </div>

    <h6 class="grey-text">üìÇ Veya dosyalarƒ± indirin</h6>
    <div class="input-row">
      <input type="file" id="file-input" accept=".m3u,.txt">
    </div>

    <div class="switch-label">
      <label for="dark-toggle">üåô Karanlƒ±k aray√ºz</label>
      <label class="switch">
        <input type="checkbox" id="dark-toggle">
        <span class="lever"></span>
      </label>
    </div>
  </li>
</ul>

<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script>
$(()=> {
  const v = $('#video')[0], toHttps=u=>u.replace(/^http:/,'https:'), epg={}, chs=[];
  let hls, dash, loadM3UTimer;
  const toast = t=>M.toast({html:t,displayLength:2000});
  const play=u=>{
    u=toHttps(u);
    if(hls)hls.destroy(); if(dash){dash.reset(); dash=null;}
    v.poster=''; v.src=''; v.load();
    if(u.endsWith('.m3u8') && Hls.isSupported()){
      hls=new Hls(); hls.loadSource(u); hls.attachMedia(v);
      hls.on(Hls.Events.MANIFEST_PARSED,()=>v.play());
    } else if(u.endsWith('.mpd')){
      dash = dashjs.MediaPlayer().create(); dash.initialize(v, u, true);
    } else {
      v.src=u;v.load();v.play();
    }
    localStorage.setItem('iptv_last_channel', u);
    $('.channel-card').removeClass('current-channel').find('.current-icon').remove();
    $(`.channel-card[data-url="${u}"]`).addClass('current-channel').append('<span class="current-icon">‚úîÔ∏è</span>');
  };
  const parseEPG=xml=>{
    const x=new DOMParser().parseFromString(xml,'text/xml');
    const now=moment();
    [...x.getElementsByTagName("programme")].forEach(p=>{
      const id=p.getAttribute("channel"),t=p.getElementsByTagName("title")[0]?.textContent||"",
      s=moment(p.getAttribute("start"),"YYYYMMDDHHmmss Z"),e=moment(p.getAttribute("stop"),"YYYYMMDDHHmmss Z");
      if(now.isBetween(s,e)) epg[id]=`${t} (${s.format("HH:mm")} - ${e.format("HH:mm")})`;
    });
    toast("üìÖ EPG ƒë√£ t·∫£i xong");
    $('.channel-card').each(function(){
      const id=$(this).data('id');$(this).find('.channel-epg').text(epg[id]||'Kh√¥ng c√≥ d·ªØ li·ªáu EPG');
    });
  };
  const parseM3U=text=>{
    $('#channel-groups').empty();chs.length=0;
    if(text.startsWith("#EXTM3U") && text.includes('url-tvg=')){
      const m=text.match(/url-tvg="(.*?)"/); if(m){
        fetch(toHttps(m[1])).then(r=>r.text()).then(parseEPG);
      }
    }
    let g='Kh√°c',logo='',id='',title='';
    text.split('\n').forEach(l=>{
      l=l.trim();
      if(l.startsWith('#EXTINF')){
        title=l.split(',').pop()||'Kh√¥ng t√™n';
        g=(l.match(/group-title="(.*?)"/)||[,'Kh√°c'])[1];
        logo=(l.match(/tvg-logo="(.*?)"/)||[,''])[1];
        id=(l.match(/tvg-id="(.*?)"/)||[,''])[1];
      } else if(l && !l.startsWith('#')){
        chs.push({title,url:toHttps(l),logo,id,group:g});
      }
    });
    const grouped={}, lastChannel=localStorage.getItem("iptv_last_channel")||"";
    chs.forEach(c=>{if(!grouped[c.group])grouped[c.group]=[];grouped[c.group].push(c);});
    for(const [grp,arr] of Object.entries(grouped)){
      $('#channel-groups').append(`<div class="channel-group">${grp} <span>(${arr.length})</span></div><div class="channel-list"></div>`);
      const $list=$('#channel-groups .channel-list').last();
      arr.forEach(c=>{
        const isCurrent = c.url===lastChannel;
        $list.append(`
          <div class="channel-card ${isCurrent?'current-channel':''}" data-url="${c.url}" data-id="${c.id}">
          ${c.logo?`<img src="${c.logo}" class="channel-logo">`:`<div class="channel-logo"></div>`}
          <div class="channel-info"><p class="channel-title">${c.title}</p>
          <p class="channel-epg">${epg[c.id]||''}</p></div>
          ${isCurrent?'<span class="current-icon">‚úîÔ∏è</span>':''}</div>`);
      });
    }
    $('.channel-group').click(function(){$(this).next().slideToggle(150);});
    $('.channel-card').click(function(){
      play($(this).data('url'));M.Sidenav.getInstance($('#menu-left')).close();
    });
    $('#search').off().on('input',function(){
      const v=$(this).val().toLowerCase(),$r=$('#search-results').empty().hide();
      if(!v)return;
      chs.filter(c=>c.title.toLowerCase().includes(v)).forEach(c=>{
        $r.append(`<div class="channel-card" data-url="${c.url}" data-id="${c.id}">
        ${c.logo?`<img src="${c.logo}" class="channel-logo">`:`<div class="channel-logo"></div>`}
        <div class="channel-info"><p class="channel-title">${c.title}</p>
        <p class="channel-epg">${epg[c.id]||''}</p></div></div>`);
      });
      if($r.children().length)$r.show();
      $('.channel-card').off().click(function(){
        play($(this).data('url'));M.Sidenav.getInstance($('#menu-left')).close();
      });
    });
    toast(`‚úÖ ƒê√£ t·∫£i ${chs.length} k√™nh`);
    if(lastChannel) play(lastChannel);
  };
  const loadM3U = () => {
    const u=toHttps($('#url-input').val().trim());
    if(!u)return;
    localStorage.setItem("iptv_m3u_url",u);
    u.match(/\.(m3u|txt)$/)
      ? fetch(u).then(r=>r.text()).then(parseM3U).catch(()=>alert("Kh√¥ng t·∫£i ƒë∆∞·ª£c M3U t·ª´ URL."))
      : play(u);
  };

  const savedM3u=localStorage.getItem("iptv_m3u_url")||"";
  $('#url-input').val(savedM3u);
  if(savedM3u) loadM3U();

  $('.sidenav').sidenav();$('.sidenav.right').sidenav({edge:'right'});
  $('#toggle-left').click(()=>M.Sidenav.getInstance($('#menu-left')).isOpen?M.Sidenav.getInstance($('#menu-left')).close():M.Sidenav.getInstance($('#menu-left')).open());
  $('#toggle-right').click(()=>M.Sidenav.getInstance($('#menu-right')).isOpen?M.Sidenav.getInstance($('#menu-right')).close():M.Sidenav.getInstance($('#menu-right')).open());
  $('#url-input').on('input', () => {
    clearTimeout(loadM3UTimer);
    loadM3UTimer = setTimeout(loadM3U, 2000);
  });
  $('#file-input').change(e=>{
    const f=e.target.files[0];if(!f)return;
    const r=new FileReader();
    r.onload=e=>parseM3U(e.target.result);r.readAsText(f);
  });
  $('#dark-toggle').on('change', function() {
    $('body').toggleClass('dark', this.checked);
    localStorage.setItem('iptv_dark', this.checked ? '1' : '0');
  });
  if(localStorage.getItem('iptv_dark')==='1'){
    $('body').addClass('dark');
    $('#dark-toggle').prop('checked', true);
  }
});
</script>
</body>
</html>
<!-- partial -->
  
</body>
</html>
